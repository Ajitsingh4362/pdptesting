<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JSON Cruncher ‚Äî PDP Validator v3.0</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&family=Bricolage+Grotesque:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
:root {
    --bg: #07090f;
    --surface: #0d1117;
    --surface2: #131820;
    --accent: #00e5a0;
    --accent-dim: rgba(0,229,160,0.12);
    --accent-glow: rgba(0,229,160,0.25);
    --red: #ff4757;
    --red-dim: rgba(255,71,87,0.12);
    --orange: #ffa502;
    --orange-dim: rgba(255,165,2,0.12);
    --text: #dde4ef;
    --text-muted: #4d5a6e;
    --text-dim: #8899aa;
    --border: #1c2433;
    --border2: #263040;
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
    font-family: 'Bricolage Grotesque', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    padding: 36px 20px 80px;
    background-image:
        radial-gradient(ellipse 80% 40% at 50% -10%, rgba(0,229,160,0.07) 0%, transparent 60%);
}

.container { max-width: 980px; margin: 0 auto; }

/* HEADER */
header { text-align: center; margin-bottom: 44px; }
.version-pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 10px;
    color: var(--accent);
    border: 1px solid rgba(0,229,160,0.3);
    background: var(--accent-dim);
    padding: 4px 14px;
    border-radius: 100px;
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 18px;
}
.version-pill::before { content:''; width:6px; height:6px; border-radius:50%; background:var(--accent); animation: pulse 2s infinite; }
h1 {
    font-size: clamp(2.8rem, 7vw, 4.5rem);
    font-weight: 800;
    letter-spacing: -3px;
    line-height: 0.9;
    margin-bottom: 12px;
}
h1 .cruncher { color: var(--red); text-shadow: 0 0 30px rgba(255,71,87,0.35); }
.tagline { font-family: 'IBM Plex Mono', monospace; font-size: 11px; color: var(--text-muted); letter-spacing: 1px; }

/* UPLOAD ZONE */
.card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 18px;
    padding: 28px;
    margin-bottom: 20px;
}
.drop-zone {
    border: 2px dashed var(--border2);
    border-radius: 14px;
    padding: 44px 20px;
    text-align: center;
    cursor: pointer;
    position: relative;
    transition: all 0.25s ease;
    background: rgba(255,255,255,0.015);
}
.drop-zone:hover, .drop-zone.active {
    border-color: var(--accent);
    background: var(--accent-dim);
}
.drop-zone input[type=file] { position:absolute; inset:0; opacity:0; cursor:pointer; width:100%; height:100%; }
.drop-icon { font-size: 40px; margin-bottom: 12px; display: block; }
.drop-title { font-weight: 800; font-size: 17px; margin-bottom: 4px; }
.drop-sub { font-family: 'IBM Plex Mono', monospace; font-size: 11px; color: var(--text-muted); }

.file-preview {
    display: none;
    margin-top: 14px;
    padding: 10px 14px;
    background: var(--accent-dim);
    border: 1px solid rgba(0,229,160,0.2);
    border-radius: 10px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 12px;
    color: var(--accent);
}
.btn-scan {
    width: 100%;
    padding: 15px;
    background: var(--accent);
    color: #000;
    font-family: 'Bricolage Grotesque', sans-serif;
    font-weight: 800;
    font-size: 15px;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    margin-top: 18px;
    transition: all 0.25s;
}
.btn-scan:hover:not(:disabled) { background: #00ffb3; box-shadow: 0 0 28px var(--accent-glow); transform: translateY(-2px); }
.btn-scan:disabled { background: var(--border2); color: var(--text-muted); cursor: not-allowed; transform: none; box-shadow: none; }

/* STATS */
.stats-grid {
    display: none;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    margin-bottom: 20px;
}
.stat-box {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 18px 14px;
    text-align: center;
}
.stat-num { font-family: 'IBM Plex Mono', monospace; font-size: 30px; font-weight: 700; display: block; line-height: 1; margin-bottom: 6px; }
.stat-lbl { font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1.5px; font-family: 'IBM Plex Mono', monospace; }

/* ACTION BAR */
.action-bar {
    display: none;
    align-items: center;
    gap: 10px;
    margin-bottom: 18px;
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 10px;
    border-radius: 12px;
}
.search-box {
    flex: 1;
    background: var(--bg);
    border: 1px solid var(--border2);
    border-radius: 8px;
    padding: 9px 14px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 12px;
    color: var(--text);
}
.search-box:focus { outline: none; border-color: var(--accent); }
.search-box::placeholder { color: var(--text-muted); }
.btn-export {
    background: transparent;
    border: 1px solid var(--accent);
    color: var(--accent);
    padding: 9px 18px;
    border-radius: 8px;
    font-family: 'Bricolage Grotesque', sans-serif;
    font-weight: 700;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
}
.btn-export:hover { background: var(--accent-dim); }

/* RESULTS */
.result-item {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    margin-bottom: 14px;
    overflow: hidden;
    transition: border-color 0.2s;
}
.result-item:hover { border-color: var(--border2); }

.result-item.has-error { border-left: 3px solid var(--red); }
.result-item.has-warn  { border-left: 3px solid var(--orange); }
.result-item.is-clean  { border-left: 3px solid var(--accent); }

/* URL ROW */
.url-row {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 14px 18px 10px;
    border-bottom: 1px solid var(--border);
}
.item-index {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 11px;
    color: var(--text-muted);
    min-width: 28px;
}
.item-url {
    flex: 1;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 12px;
    color: #60a5fa;
    text-decoration: none;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.item-url:hover { color: #93c5fd; text-decoration: underline; }
.badges { display: flex; gap: 6px; flex-shrink: 0; }
.badge {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 10px;
    font-weight: 700;
    padding: 3px 9px;
    border-radius: 5px;
    letter-spacing: 0.5px;
    text-transform: uppercase;
}
.badge-err  { background: var(--red); color: #000; }
.badge-warn { background: var(--orange-dim); color: var(--orange); border: 1px solid var(--orange); }
.badge-ok   { background: var(--accent-dim); color: var(--accent); border: 1px solid rgba(0,229,160,0.4); }

/* ISSUES */
.issues-area { padding: 14px 18px 16px; }
.issues-area.empty { padding: 12px 18px; }
.clean-msg {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 11px;
    color: var(--accent);
    display: flex;
    align-items: center;
    gap: 7px;
}

.fields-section { margin-bottom: 10px; }
.fields-section:last-child { margin-bottom: 0; }
.section-label {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 9px;
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 6px;
}
.section-label .dot { width: 7px; height: 7px; border-radius: 50%; flex-shrink: 0; }
.dot-red    { background: var(--red);    box-shadow: 0 0 6px var(--red); }
.dot-orange { background: var(--orange); box-shadow: 0 0 6px var(--orange); }
.section-label span   { color: var(--text-muted); }
.section-label strong { color: var(--text-dim); }

.chips-row { display: flex; flex-wrap: wrap; gap: 6px; }

.chip {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 5px 10px;
    border-radius: 7px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 11.5px;
    font-weight: 500;
    letter-spacing: 0.2px;
    white-space: nowrap;
}
.chip-error {
    background: var(--red-dim);
    border: 1px solid rgba(255,71,87,0.35);
    color: #ff8a96;
}
.chip-error .chip-key  { color: #ff4757; font-weight: 700; font-size: 12px; }
.chip-error .chip-type { color: #ff8a96; font-size: 10px; background: rgba(255,71,87,0.15); padding: 1px 6px; border-radius: 4px; }

.chip-warn {
    background: var(--orange-dim);
    border: 1px solid rgba(255,165,2,0.3);
    color: #ffc156;
}
.chip-warn .chip-key  { color: var(--orange); font-weight: 700; font-size: 12px; }
.chip-warn .chip-type { color: #ffc156; font-size: 10px; background: rgba(255,165,2,0.12); padding: 1px 6px; border-radius: 4px; }

/* LEGEND */
.legend {
    display: none;
    align-items: center;
    gap: 18px;
    padding: 10px 16px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    margin-bottom: 16px;
}
.legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 10px;
    color: var(--text-muted);
}

footer {
    text-align: center;
    margin-top: 60px;
    padding-top: 24px;
    border-top: 1px solid var(--border);
    font-family: 'IBM Plex Mono', monospace;
    font-size: 11px;
    color: var(--text-muted);
}
footer span { color: var(--accent); font-weight: 700; }

@keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:0.3; } }
@keyframes fadeIn { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }
.result-item { animation: fadeIn 0.25s ease-out both; }

::-webkit-scrollbar { width:5px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--border2); border-radius:10px; }
</style>
</head>
<body>

<div class="container">

    <header>
        <div class="version-pill">v3.0 Premium</div>
        <h1>JSON <span class="cruncher">CRUNCHER</span></h1>
        <p class="tagline">// PDP Schema Validator ¬∑ Works flawlessly for 20+ users simultaneously</p>
    </header>

    <div class="card">
        <div class="drop-zone" id="dropZone">
            <input type="file" id="fileInput" accept=".json" multiple>
            <span class="drop-icon">‚ö°</span>
            <div class="drop-title">Drop JSON Files Here</div>
            <div class="drop-sub">Or click to browse ‚Äî multiple files supported</div>
        </div>
        <div class="file-preview" id="filePreview"></div>
        <button class="btn-scan" id="scanBtn" disabled onclick="validate()">Scan Files for Issues</button>
    </div>

    <div class="stats-grid" id="statsGrid">
        <div class="stat-box">
            <span class="stat-num" id="s-total">0</span>
            <span class="stat-lbl">Processed</span>
        </div>
        <div class="stat-box">
            <span class="stat-num" id="s-err" style="color:var(--red)">0</span>
            <span class="stat-lbl">Critical</span>
        </div>
        <div class="stat-box">
            <span class="stat-num" id="s-warn" style="color:var(--orange)">0</span>
            <span class="stat-lbl">Warnings</span>
        </div>
        <div class="stat-box">
            <span class="stat-num" id="s-ok" style="color:var(--accent)">0</span>
            <span class="stat-lbl">Clean</span>
        </div>
    </div>

    <div class="action-bar" id="actionBar">
        <input type="text" class="search-box" id="urlSearch" placeholder="üîç  Filter by URL..." oninput="renderResults()">
        <button class="btn-export" onclick="downloadExcel()">‚¨á Export XLSX</button>
    </div>

    <div class="legend" id="legend">
        <div class="legend-item"><span class="dot dot-red"></span> Critical ‚Äî Missing / Null / Empty</div>
        <div class="legend-item"><span class="dot dot-orange"></span> Warning ‚Äî Empty Array / Duplicate</div>
    </div>

    <div id="resultsWrapper"></div>

    <footer>
        <p>JSON Cruncher ‚Äî PDP Validator Engine &nbsp;|&nbsp; Made with ‚ù§Ô∏è by <span>AJIT KUMAR</span></p>
    </footer>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ SCHEMA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SCHEMA = new Set([
    'url','item_id','variant_id','title','description','product_category',
    'category_tree','brand','image_url','price','sale_price','availability',
    'availability_date','group_id','listing_has_variations','variant_attributes',
    'variants','store_name','seller_url','seller_privacy_policy','seller_tos',
    'return_policy','return_window','target_countries','store_country',
    'category_urls','all_variations'
]);

let DATA_STORE = [];
let loadedFiles = [];

// ‚îÄ‚îÄ‚îÄ FILE HANDLING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const fileInput = document.getElementById('fileInput');
const dropZone  = document.getElementById('dropZone');

fileInput.addEventListener('change', e => handleFiles(e.target.files));

dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('active'); });
dropZone.addEventListener('dragleave', () => dropZone.classList.remove('active'));
dropZone.addEventListener('drop', e => {
    e.preventDefault();
    dropZone.classList.remove('active');
    handleFiles(e.dataTransfer.files);
});

function handleFiles(files) {
    loadedFiles = Array.from(files);
    const fp = document.getElementById('filePreview');
    fp.style.display = 'block';
    fp.textContent = `‚úì  ${loadedFiles.length} file(s) ready: ${loadedFiles.map(f => f.name).join(', ')}`;
    document.getElementById('scanBtn').disabled = false;
}

// ‚îÄ‚îÄ‚îÄ VALIDATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function validate() {
    DATA_STORE = [];
    const btn = document.getElementById('scanBtn');
    btn.textContent = 'Analyzing‚Ä¶';
    btn.disabled = true;

    for (const file of loadedFiles) {
        let text;
        try { text = await file.text(); } catch(e) { continue; }
        try {
            const json = JSON.parse(text);
            const items = Array.isArray(json) ? json : [json];

            items.forEach(item => {
                const errors = [], warnings = [];

                // Check schema fields only
                for (const key of SCHEMA) {
                    const val = item[key];
                    if (!(key in item)) {
                        errors.push({ key, type: 'MISSING' });
                    } else if (val === null || val === undefined || val === '') {
                        errors.push({ key, type: 'NULL / EMPTY' });
                    } else if (Array.isArray(val) && val.length === 0) {
                        warnings.push({ key, type: 'EMPTY ARRAY' });
                    } else if (Array.isArray(val)) {
                        const strs = val.map(v => JSON.stringify(v));
                        if (new Set(strs).size !== strs.length)
                            warnings.push({ key, type: 'DUPLICATE DATA' });
                    }
                }

                // Extra fields check REMOVED

                DATA_STORE.push({
                    url: item.url || 'N/A',
                    errors, warnings,
                    hasError: errors.length > 0,
                    hasWarn:  warnings.length > 0
                });
            });
        } catch(e) { alert('Invalid JSON: ' + file.name); }
    }

    updateStats();
    renderResults();
    btn.textContent = 'Scan Again';
    btn.disabled = false;
}

// ‚îÄ‚îÄ‚îÄ STATS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateStats() {
    document.getElementById('statsGrid').style.display = 'grid';
    document.getElementById('actionBar').style.display  = 'flex';
    document.getElementById('legend').style.display     = 'flex';
    document.getElementById('s-total').textContent = DATA_STORE.length;
    document.getElementById('s-err').textContent   = DATA_STORE.filter(d => d.hasError).length;
    document.getElementById('s-warn').textContent  = DATA_STORE.filter(d => d.hasWarn && !d.hasError).length;
    document.getElementById('s-ok').textContent    = DATA_STORE.filter(d => !d.hasError && !d.hasWarn).length;
}

// ‚îÄ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderResults() {
    const q = document.getElementById('urlSearch').value.toLowerCase();
    const wrapper = document.getElementById('resultsWrapper');
    wrapper.innerHTML = '';

    const filtered = DATA_STORE.filter(d => d.url.toLowerCase().includes(q));

    filtered.forEach((item, idx) => {
        const el = document.createElement('div');
        el.className = 'result-item ' + (
            item.hasError ? 'has-error' :
            item.hasWarn  ? 'has-warn'  : 'is-clean'
        );
        el.style.animationDelay = (idx * 0.025) + 's';

        // Badges
        let badges = '';
        if (item.errors.length)   badges += `<span class="badge badge-err">${item.errors.length} Critical</span>`;
        if (item.warnings.length) badges += `<span class="badge badge-warn">${item.warnings.length} Warn</span>`;
        if (!item.errors.length && !item.warnings.length)
            badges = `<span class="badge badge-ok">‚úì Clean</span>`;

        // Chips builder
        function buildChips(arr, cls) {
            return arr.map(iss => `
                <span class="chip ${cls}">
                    <span class="chip-key">${iss.key}</span>
                    <span class="chip-type">${iss.type}</span>
                </span>`).join('');
        }

        let issuesHTML = '';
        if (!item.hasError && !item.hasWarn) {
            issuesHTML = `<div class="issues-area empty"><div class="clean-msg">‚úì &nbsp;All required fields are present and valid.</div></div>`;
        } else {
            let sections = '';
            if (item.errors.length) sections += `
                <div class="fields-section">
                    <div class="section-label">
                        <span class="dot dot-red"></span>
                        <strong style="color:var(--red)">CRITICAL</strong>
                        <span>(${item.errors.length} fields)</span>
                    </div>
                    <div class="chips-row">${buildChips(item.errors, 'chip-error')}</div>
                </div>`;
            if (item.warnings.length) sections += `
                <div class="fields-section">
                    <div class="section-label">
                        <span class="dot dot-orange"></span>
                        <strong style="color:var(--orange)">WARNINGS</strong>
                        <span>(${item.warnings.length} fields)</span>
                    </div>
                    <div class="chips-row">${buildChips(item.warnings, 'chip-warn')}</div>
                </div>`;
            issuesHTML = `<div class="issues-area">${sections}</div>`;
        }

        el.innerHTML = `
            <div class="url-row">
                <span class="item-index">#${idx + 1}</span>
                <a href="${item.url}" target="_blank" class="item-url">${item.url}</a>
                <div class="badges">${badges}</div>
            </div>
            ${issuesHTML}
        `;
        wrapper.appendChild(el);
    });
}

// ‚îÄ‚îÄ‚îÄ EXPORT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function downloadExcel() {
    const rows = DATA_STORE.map((d, i) => {
        const row = {
            '#': i + 1,
            URL: d.url,
            Status: d.hasError ? 'ERROR' : d.hasWarn ? 'WARNING' : 'OK'
        };
        d.errors.forEach(e => row[e.key] = e.type);
        d.warnings.forEach(e => row[e.key] = e.type);
        return row;
    });
    const ws = XLSX.utils.json_to_sheet(rows);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'Audit');
    XLSX.writeFile(wb, 'PDP_Audit_Report.xlsx');
}
</script>

</body>
</html>
